{% extends "base.html" %}
{% block content %}

<section class="card">
    <h2 class="glow-title">ูุงุฆูุฉ ุงูุทูุงุจ ุงููุณุฌููู</h2>

    <form method="GET" class="search-bar-styled">
        
        <div class="search-group input-group-search">
            <input type="text" name="q" value="{{ request.args.get('q', '') }}" placeholder="ุจุญุซ ุจุงูุงุณู ุฃู ุงูุฑูู ุงูุฌุงูุนู..." autocomplete="off">
        </div>

        <div class="search-group dropdown-group">
            <select name="level" class="search-select">
                <option value="">-- ูู ุงููุฑุงุญู --</option>
                <option value="ูุงุฌุณุชูุฑ" {% if request.args.get('level')=='ูุงุฌุณุชูุฑ' %}selected{% endif %}>ูุงุฌุณุชูุฑ</option>
                <option value="ุฏูุชูุฑุงู" {% if request.args.get('level')=='ุฏูุชูุฑุงู' %}selected{% endif %}>ุฏูุชูุฑุงู</option>
                <option value="ุฏุจููู ุนุงูู" {% if request.args.get('level')=='ุฏุจููู ุนุงูู' %}selected{% endif %}>ุฏุจููู ุนุงูู</option>
            </select>
        </div>

        <div class="search-group dropdown-group">
            <select name="study_type" class="search-select">
                <option value="">-- ููุน ุงูุฏุฑุงุณุฉ --</option>
                <option value="ุตุจุงุญู" {% if request.args.get('study_type')=='ุตุจุงุญู' %}selected{% endif %}>ุตุจุงุญู</option>
                <option value="ูุณุงุฆู" {% if request.args.get('study_type')=='ูุณุงุฆู' %}selected{% endif %}>ูุณุงุฆู</option>
            </select>
        </div>
        
        <div class="search-group btn-group-search">
            <button type="submit" class="search-btn">๐ ุจุญุซ</button>
        </div>
    </form>
    
    <div class="table-responsive">
        <table class="data-table">
            <thead>
                <tr>
                    <th>#</th>
                    <th>ุงูุงุณู (ุงุถุบุท ููุนุฑุถ)</th> 
                    <th>ุงูุฑูู ุงูุฌุงูุนู</th>
                    <th>ุงููุฑุญูุฉ</th>
                    <th>ุงูุฏุฑุงุณุฉ</th>
                    <th>ุงููุนุฏู</th>
                    <th>ุงููุจูู</th>
                    <th style="min-width: 280px;">ุฅุฌุฑุงุกุงุช</th>
                </tr>
            </thead>
            <tbody>
                {% for s in students %}
                <tr>
                    <td>{{ s.id }}</td>
                    
                    {# --- ุฎุงูุฉ ุงูุงุณู ุงููุงุจูุฉ ููููุฑ --- #}
                    <td style="padding: 0 !important; vertical-align: middle;">
                        <a href="{{ url_for('admin_student_view', student_id=s.id) }}" 
                           style="display: block; 
                                  width: 100%; 
                                  height: 100%; 
                                  padding: 15px 10px; 
                                  color: #fff; 
                                  font-weight: bold; 
                                  text-decoration: none; 
                                  cursor: pointer;"
                           title="ุงุถุบุท ูุนุฑุถ ุงูููู ุงููุงูู">
                            {{ s.full_name }}
                        </a>
                    </td>
                    
                    <td>{{ s.student_id }}</td>
                    <td><span class="role-tag" style="background: #e67e22; color: #fff;">{{ s.level }}</span></td>
                    <td>{{ s.study_type }}</td>
                    <td style="color: var(--primary-color); font-weight: bold;">{{ s.avg or '---' }}</td>
                    <td>{{ s.admission_type or '---' }}</td>
                    
                    <td class="actions-cell" style="vertical-align: middle;">
                        <div style="display: flex; gap: 5px; justify-content: center; flex-wrap: wrap;">
                            
                            <a href="{{ url_for('admin_student_full_edit', student_id=s.id) }}" 
                               class="action-btn full-edit-link" 
                               style="font-size: 0.8rem; padding: 5px 8px; white-space: nowrap;">ุชุนุฏูู ุจูุงูุงุช</a>

                            <a href="{{ url_for('admin_student_edit', student_id=s.id) }}" 
                               class="action-btn edit-link" 
                               style="font-size: 0.8rem; padding: 5px 8px; white-space: nowrap;">ุชุนุฏูู ุฏุฑุฌุงุช</a>

                            <a href="{{ url_for('admin_student_print', student_id=s.id) }}" 
                               class="action-btn print-link" target="_blank"
                               style="font-size: 0.8rem; padding: 5px 8px; white-space: nowrap;">ุทุจุงุนุฉ</a>

                            <form action="{{ url_for('admin_student_delete', student_id=s.id) }}" method="POST" 
                                  style="display: inline-block; margin: 0;" onsubmit="return confirm('ูู ุฃูุช ูุชุฃูุฏ ูู ุญุฐู ุณุฌู ุงูุทุงูุจ ุจุงููุงููุ');">
                                <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
                                <button type="submit" class="action-btn delete-link" 
                                        style="background-color: #e74c3c; color: white; font-size: 0.8rem; padding: 5px 8px; white-space: nowrap; border:none; cursor:pointer; border-radius:4px;">
                                    ุญุฐู
                                </button>
                            </form>
                        </div>
                    </td>
                </tr>
                {% else %}
                <tr>
                    <td colspan="8" class="no-data-row">ูุง ููุฌุฏ ุทูุงุจ ูุทุงุจููู ููุจุญุซ.</td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>

    <div class="btn-box" style="margin-top: 20px; justify-content: flex-end; gap: 15px;">
        <a href="{{ url_for('admin_export_csv') }}" class="next-btn" style="background: #27ae60; color: #fff;">ุชุตุฏูุฑ Excel</a>
        <a href="{{ url_for('dashboard') }}" class="back-btn">ุนูุฏุฉ ูููุญุฉ ุงูุชุญูู</a>
    </div>
</section>

{% endblock %}