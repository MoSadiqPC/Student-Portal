{% extends "base.html" %}
{% block content %}

<section class="card admin-management-card">
    <h2 class="glow-title">إدارة المشرفين</h2>

    <div class="sub-card add-admin-form">
        <h3 class="section-heading">إضافة مشرف جديد</h3>
        <form method="POST" class="filter-form add-form-grid">
            <input type="hidden" name="action" value="add">
            <input type="hidden" name="csrf_token" value="{{ csrf_token() }}"> <div class="input-group">
                <label>اسم المستخدم</label>
                <input type="text" name="new_username" required>
            </div>

            <div class="input-group">
                <label>كلمة المرور</label>
                <input type="password" name="new_password" required>
            </div>

            <div class="input-group role-selector">
                <label>الصلاحية</label>
                <select name="new_role">
                    <option value="admin">مشرف (Admin)</option>
                    <option value="super">مدير (Super)</option>
                </select>
            </div>

            <div class="input-group submit-actions">
                <button type="submit" class="next-btn success-btn">إضافة</button>
            </div>
        </form>
    </div>

    <h3 class="section-heading">قائمة المشرفين الحاليين</h3>
    <div class="table-responsive">
        <table class="data-table admin-table">
            <thead>
                <tr>
                    <th class="text-right">اسم المستخدم</th>
                    <th class="text-right">الصلاحية</th>
                    <th class="text-right">إجراءات</th>
                </tr>
            </thead>
            <tbody>
                {% for admin in admins %}
                <tr>
                    <td>{{ admin.username }}</td>
                    <td>
                        {% if admin.role == 'super' %}
                        <span class="role-tag role-super">مدير</span>
                        {% else %}
                        <span class="role-tag role-admin">مشرف</span>
                        {% endif %}
                    </td>
                    <td class="actions-cell">
                        {% if admin.username != 'admin' and admin.username != session['user']['username'] %}
                        <form method="POST" class="delete-form" 
                            onsubmit="return confirm('هل أنت متأكد من حذف المشرف {{ admin.username }}؟');">
                            <input type="hidden" name="action" value="delete">
                            <input type="hidden" name="csrf_token" value="{{ csrf_token() }}"> 
                            <input type="hidden" name="username" value="{{ admin.username }}">
                            <button type="submit" class="action-btn delete-link">حذف</button>
                        </form>
                        {% else %}
                        <span class="disabled-action">لا يمكن حذفه</span>
                        {% endif %}
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>

    <div class="btn-box" style="margin-top: 30px;">
        <a href="{{ url_for('dashboard') }}" class="back-btn">عودة للوحة التحكم</a>
    </div>
</section>

{% endblock %}